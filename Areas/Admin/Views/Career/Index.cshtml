@model IEnumerable<QuanLyNhaHang.Models.TuyenDung>
@{
    ViewBag.Title = "Danh Sách Tuyển Dụng";
    Layout = "~/Areas/NhanVien/Views/Shared/_LayoutNhanVien.cshtml";
}

<div class="container" id="DanhSachHoaDon">
    <div class="page-title-container">
        <div class="row g-0">
            <div class="col-auto mb-3 mb-md-0 me-auto">
                <div class="w-auto">
                    <h1 class="mb-0 pb-0 " id="title">Danh Sách Ứng Tuyển</h1>
                </div>
            </div>
            
        </div>
    </div>
    <div class="row mb-2">
        <div class="col-sm-12 col-md-5 col-lg-3 col-xxl-2 mb-1">
            <div class="d-inline-block float-md-start me-1 mb-1 search-input-container w-100 shadow bg-foreground">
                <input class="form-control search" placeholder="Search">
                <span class="search-magnifier-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="cs-icon cs-icon-search"><circle cx="9" cy="9" r="7"></circle><path d="M14 14L17.5 17.5"></path></svg>
                </span>
                <span class="search-delete-icon d-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="cs-icon cs-icon-close"><path d="M5 5 15 15M15 5 5 15"></path></svg>
                </span>
            </div>
        </div>
    </div>
    <div class="row g-0">
        <div class="col-12 mb-5">
            <div id="checkboxTable">
                <div class="mb-4 mb-lg-3 bg-transparent no-shadow d-none d-lg-block">
                    <div class="row g-0">
                        <div class="col">
                            <div class="ps-5 pe-4 h-100">
                                <div class="row g-0 h-100 align-content-center custom-sort">
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TenKhachHang">Họ Tên</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TenKhachHang">Ngày Sinh</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TenKhachHang">Địa Chỉ</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TenKhachHang">SDT</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TenKhachHang">Vị trí</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="ThanhToan">Ngày nộp</div>
                                    </div>
                                    <div class="col-lg-1 d-flex flex-column pe-1 justify-content-center">
                                        <div class="text-muted text-body cursor-pointer sort" data-sort="TongTien">Trạng thái</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- #region Danh sách hóa đơn -->
                <div class="list">
                    @foreach (var item in Model)
                    {
                        <div class="card mb-2">
                            <div class="row g-0 h-100 sh-lg-9 position-relative">
                                <div class="col py-4 py-lg-0">
                                    <div class="ps-5 pe-4 h-100">
                                        <div class="row g-0 h-100 align-content-center">
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate TaiKhoan">@item.Hoten</div>
                                            </div>
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate NgaySinh">@string.Format("{0:dd/MM/yyyy}", item.NgaySinh)</div>
                                            </div>
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate SDT">@item.DiaChi</div>
                                            </div>
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate SDT">@item.SDT</div>
                                            </div>
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate SDT">@item.Vitri</div>
                                            </div>
                                            <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                <div class="lh-1 text-alternate NgaySinh">@string.Format("{0:dd/MM/yyyy}", item.NgayNopDon)</div>
                                            </div>
                                            @if (item.Duyet == true)
                                            {
                                                <div class="col-12 col-lg-1 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                    <input type="checkbox" class="approval-checkbox" data-id="@item.STT" checked>
                                                </div>
                                            }
                                            else { 
                                                <div class="col-12 col-lg-2 d-flex flex-column pe-1 mb-2 mb-lg-0 justify-content-center order-3">
                                                    <input type="checkbox" class="approval-checkbox" data-id="@item.STT">
                                                </div>
                                            }                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <!-- #endregion -->
                <div class="w-100 d-flex justify-content-center">
                    <ul class="pagination"></ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- #region Script lọc -->
<script type="text/javascript">
    var options = {
        valueNames: ['TenNhanhVien', 'TaiKhoan', 'NgaySinh', 'SDT'],
        page: 8,
        pagination: true
    };
    var userList = new List('DanhSachHoaDon', options);

    document.addEventListener('DOMContentLoaded', () => {
        // Lấy tất cả các checkbox với class 'approval-checkbox'
        const checkboxes = document.querySelectorAll('.approval-checkbox');

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', async (event) => {
                // Lấy ID và trạng thái của checkbox
                const checkbox = event.target;
                const id = checkbox.dataset.id; // Lấy id từ data-id
                const status = checkbox.checked; 

                // Chuẩn bị dữ liệu để gửi đi
                const data = {
                    id: id,
                    approved: status
                };

                try {
                    // Gửi request tới server
                    const response = await fetch('/Admin/Career/Approve', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    // Kiểm tra phản hồi từ server
                    if (response.ok) {
                        const result = await response.json();
                        console.log('Cập nhật thành công:', result);
                    } else {
                        console.error('Cập nhật thất bại:', response.statusText);
                    }
                } catch (error) {
                    console.error('Lỗi khi gửi request:', error);
                }
            });
        });
    });
</script>
